<Window x:Class="TBT.App.Views.Windows.MainWindow"
        x:Name="mainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:TBT.App.Views.Windows"
        xmlns:vm="clr-namespace:TBT.App.ViewModels"
        xmlns:controls="clr-namespace:TBT.App.Views.Controls"
        Closing="Window_Closing"
        mc:Ignorable="d"
        Loaded="this_Loaded"
        Icon="../../calendar_clock.ico"
        SizeChanged="this_SizeChanged"
        Title="Time Booking Tool" 
        Height="700" 
        Width="600" 
        ResizeMode="CanMinimize"
        Style="{StaticResource WindowStyle}">

    <Window.DataContext>
        <vm:MainWindowViewModel/>
    </Window.DataContext>
    <Grid Margin="20 20 20 0">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>

        </Grid.ColumnDefinitions>


        <TabControl Grid.Row="0">
            <TabItem HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" Header="Calendar" Tag="../Icons/calendar.png">
                <controls:CalendarControl x:Name="calendar" User="{Binding CurrentUser, Mode=TwoWay}" IsDateNameShort="False" Background="White"/>
            </TabItem>

            <TabItem HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" Header="Reporting" Tag="../Icons/reporting.png">
                <Grid Background="White">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch" Grid.Row="0"
                                Visibility="{Binding CurrentUser.IsAdmin, Converter={StaticResource BoolToVisibilityConverter}}" Margin="30 20 20 0">
                        <TextBlock Text="User" Width="50"
                                   Foreground="#4d4d4d" FontSize="13"
                                   VerticalAlignment="Center"
                                   TextAlignment="Left"/>
                        <ComboBox 
                                  Width="438" FontSize="13" FontWeight="Bold" Foreground="#c2422b"
                                  VerticalAlignment="Center"
                                  Style="{StaticResource ComboBoxFlatStyle}"
                                  ItemsSource="{Binding ElementName=mainWindow, Path=Users}" 
                                  SelectedValue="{Binding ElementName=mainWindow, Path=ReportingUser, Mode=TwoWay}"/>
                    </StackPanel>


                    <controls:ReportingControl Grid.Row="1" Margin="30 20 20 20"
                                               TimeEntries="{Binding ElementName=mainWindow, Path=TimeEntries, Mode=TwoWay}" 
                                               ItemsLoading="{Binding ElementName=mainWindow, Path=ItemsLoading, Mode=TwoWay}"
                                               From="{Binding ElementName=mainWindow, Path=From, Mode=TwoWay}"
                                               To="{Binding ElementName=mainWindow, Path=To, Mode=TwoWay}"
                                               IsAdmin="{Binding DataContext.CurrentUser.IsAdmin, RelativeSource={RelativeSource FindAncestor, AncestorType=Window}}"
                                               User="{Binding ElementName=mainWindow, Path=ReportingUser}"/>
                </Grid>
            </TabItem>

            <TabItem HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" Header="People" Tag="../Icons/people.png">
                <Grid Background="White">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Grid x:Name="newUserGrid" Grid.Row="0" Margin="20 20 20 0" 
                          Visibility="{Binding Path=CurrentUser.IsAdmin, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">

                        <Expander Header="New User" Height="Auto" VerticalAlignment="Center" FontSize="13" FontWeight="Bold">
                            <controls:NewUserControl User="{Binding ElementName=mainWindow, Path=NewUser, Mode=TwoWay}" HorizontalAlignment="Stretch" FontSize="13" FontWeight="Normal" 
                                                     Margin="10"/>
                        </Expander>
                    </Grid>

                    <Grid Grid.Row="1" Margin="20 10 20 0">

                        <Expander Header="Edit my profile" Height="Auto" VerticalAlignment="Center" FontSize="13" FontWeight="Bold">
                            <Grid HorizontalAlignment="Center" Width="495">

                                <Grid.RowDefinitions>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <controls:EditUserControl User="{Binding Path=CurrentUser, Mode=TwoWay}" 
                                                          Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" 
                                                          ShowAdmin="False" 
                                                          ShowPassword="False"
                                                          ForSaving="True" Width="Auto" FontSize="13" FontWeight="Normal" Margin="10"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" VerticalAlignment="Center" Text="Old password" HorizontalAlignment="Left" Margin="10 0 0 5"  FontSize="13" FontWeight="Normal"/>
                                <TextBlock Grid.Row="4" Grid.Column="0" VerticalAlignment="Center" Text="New password" HorizontalAlignment="Left" Margin="10 0 0 5" FontSize="13" FontWeight="Normal"/>
                                <TextBlock Grid.Row="5" Grid.Column="0" VerticalAlignment="Center" Text="Confirm password" HorizontalAlignment="Left" Margin="10 0 0 5" FontSize="13" FontWeight="Normal"/>


                                <PasswordBox x:Name="oldPassword" Grid.Row="3" Grid.Column="1" Margin="2 0 10 5" Height="20" FontSize="13" FontWeight="Normal"/>
                                <PasswordBox x:Name="newPassword" Grid.Row="4" Grid.Column="1" Margin="2 0 10 5" Height="20" FontSize="13" FontWeight="Normal"/>
                                <PasswordBox x:Name="confirmPassword" Grid.Row="5" Grid.Column="1" Margin="2 0 10 5" Height="20" FontSize="13" FontWeight="Normal"/>

                                <Button Grid.Row="6" Grid.Column="1" Click="ChangePassword_ButtonClick" Content="Change" Template="{StaticResource HyperlinkButtonTemplate}"
                                        HorizontalAlignment="Right" Height="25" Margin="0 5 10 5" FontSize="13" FontWeight="Normal"/>

                            </Grid>
                        </Expander>
                    </Grid>

                    <Grid Grid.Row="2">
                        <StackPanel Margin="0 10 20 10" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom">
                            <Button Click="RefreshUsers_ButtonClick" Template="{StaticResource HyperlinkButtonTemplate}" Margin="0">
                                <Image Source="../../Resources/Icons/refresh_black.png" Height="18" ToolTip="Refresh" />
                            </Button>
                        </StackPanel>
                    </Grid>

                    <Grid Grid.Row="3"
                          Margin="20" 
                          Height="50"
                          Width="50"
                          Visibility="{Binding ElementName=mainWindow, Path=UsersLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                          HorizontalAlignment="Center" 
                          VerticalAlignment="Center">

                        <controls:SpinnersCogs/>
                    </Grid>

                    <Grid Grid.Row="3"
                          Visibility="{Binding ElementName=mainWindow, Path=UsersLoading, Converter={StaticResource BoolToNotVisibilityConverter}}">
                        <ScrollViewer 
                              Margin="20 5 20 20" 
                              MinHeight="100"
                              VerticalScrollBarVisibility="Auto"
                              VerticalAlignment="Top" 
                              HorizontalAlignment="Stretch">

                            <ItemsControl ItemsSource="{Binding ElementName=mainWindow, Path=Users, Mode=TwoWay}" Grid.IsSharedSizeScope="True">

                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid HorizontalAlignment="Stretch"
                                                      Visibility="{Binding ElementName=mainWindow, Path=IsEditing, Converter={StaticResource BoolToNotVisibilityConverter}}">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition/>
                                            </Grid.RowDefinitions>

                                            <Rectangle Stroke="#C2C2C2" Height="1" Grid.ColumnSpan="6"/>

                                            <Grid HorizontalAlignment="Center" Grid.Row="1" Margin="0 5">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition SharedSizeGroup="Admin" Width="20"/>
                                                    <ColumnDefinition SharedSizeGroup="FullName" Width="130"/>
                                                    <ColumnDefinition SharedSizeGroup="Username" Width="170"/>
                                                    <ColumnDefinition SharedSizeGroup="IsAdmin" Width="30"/>
                                                    <ColumnDefinition SharedSizeGroup="Project" Width="80"/>
                                                    <ColumnDefinition SharedSizeGroup="Remove" Width="30"/>
                                                    <ColumnDefinition SharedSizeGroup="Edit" Width="25"/>
                                                </Grid.ColumnDefinitions>

                                                <Image Height="16" Grid.Column="0" Margin="0 5" Source="../../Resources/Icons/administrator.png">
                                                    <Image.Style>
                                                        <Style TargetType="Image">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsAdmin}" Value="True">
                                                                    <Setter Property="Visibility" Value="Visible"></Setter>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding IsAdmin}" Value="False">
                                                                    <Setter Property="Visibility" Value="Hidden"></Setter>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Image.Style>
                                                </Image>

                                                <TextBlock Height="20" Grid.Column="1" Margin="5" Text="{Binding FullName}" VerticalAlignment="Center">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsAdmin}" Value="True">
                                                                    <Setter Property="Foreground" Value="#c2422b"></Setter>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>

                                                <TextBlock Height="20" Grid.Column="2" Margin="5" Text="{Binding Username}" VerticalAlignment="Center">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsAdmin}" Value="True">
                                                                    <Setter Property="Foreground" Value="#c2422b"></Setter>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>

                                                <CheckBox Height="20" Grid.Column="3" Margin="5" 
                                                              IsChecked="{Binding IsAdmin, Mode=TwoWay}"
                                                              Checked="CheckBox_Checked"
                                                              Unchecked="CheckBox_Unchecked"
                                                              IsEnabled="False"/>

                                                <controls:MultiSelectionComboBox Grid.Column="4" Margin="5 3"
                                                                                 ItemsSourceMultiple="{Binding Projects}" 
                                                                                 Width="Auto" Style="{StaticResource ComboBoxFlatStyle}"
                                                                                 Visibility="{Binding ElementName=mainWindow, Path=DataContext.CurrentUser.IsAdmin, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                                                                 User="{Binding}"/>

                                                <Image Height="20" Grid.Column="5" Margin="5" Source="../../Resources/Icons/editing.png" Width="20"
                                                       Visibility="{Binding ElementName=mainWindow, Path=DataContext.CurrentUser.IsAdmin, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                                       MouseUp="EditUser_ImageClick" Cursor="Hand"/>

                                                <Image Height="20" Grid.Column="6" Margin="0 5 5 5" Source="../../Resources/Icons/bin.png" Width="20"
                                                            Visibility="{Binding ElementName=mainWindow, Path=DataContext.CurrentUser.IsAdmin, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                                            MouseUp="RemoveUser_ImageClick" Cursor="Hand"/>
                                            </Grid>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>
                </Grid>
            </TabItem>

            <TabItem HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" Header="Customers"
                     Visibility="{Binding CurrentUser.IsAdmin, Converter={StaticResource BoolToVisibilityConverter}}" Tag="../Icons/customers.png">
                <Grid Background="White">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0" HorizontalAlignment="Stretch" Margin="20 20 20 0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition SharedSizeGroup="textBox" Width="335"/>
                            <ColumnDefinition SharedSizeGroup="label"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Orientation="Horizontal">
                            <TextBox x:Name="NewCustomerTextBox" VerticalContentAlignment="Center" Margin="0 5"  Width="305" Style="{StaticResource AddingTextBoxStyle}" />
                            <Button Click="CreateNewCustomerButton_Click" Template="{StaticResource HyperlinkButtonTemplate}" Margin="5" HorizontalAlignment="Right">
                                <Image Source="../../Resources/Icons/plus.png" Height="18" ToolTip="Create customer" />
                            </Button>
                        </StackPanel>

                        <Button Grid.Column="1" Command="{Binding ElementName=mainWindow, Path=GetCustomersCommand}" Template="{StaticResource HyperlinkButtonTemplate}" Margin="0" HorizontalAlignment="Right">
                            <Image Source="../../Resources/Icons/refresh_black.png" Height="18" ToolTip="Refresh" />
                        </Button>
                    </Grid>

                    <Grid Grid.Row="2"
                          Margin="20" 
                          Height="50"
                          Width="50"
                          Visibility="{Binding ElementName=mainWindow, Path=ItemsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                          HorizontalAlignment="Center" 
                          VerticalAlignment="Center">

                        <controls:SpinnersCogs/>
                    </Grid>

                    <Grid VerticalAlignment="Top" 
                          Grid.Row="2"
                          Margin="20"
                          Visibility="{Binding ElementName=mainWindow, Path=ItemsLoading, Converter={StaticResource BoolToNotVisibilityConverter}}">

                        <ScrollViewer
                              MinHeight="100"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalAlignment="Stretch">

                            <ItemsControl x:Name="CustomersItemsControl" ItemsSource="{Binding ElementName=mainWindow, Path=Customers, Mode=TwoWay}" Grid.IsSharedSizeScope="True">

                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid HorizontalAlignment="Stretch">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition/>
                                            </Grid.RowDefinitions>

                                            <Rectangle Stroke="#C2C2C2" Height="1" Grid.ColumnSpan="3" />

                                            <Grid HorizontalAlignment="Center" Grid.Row="1" Margin="0 10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition SharedSizeGroup="column1"/>
                                                    <ColumnDefinition SharedSizeGroup="column2"/>
                                                    <ColumnDefinition SharedSizeGroup="column3"/>
                                                    <ColumnDefinition SharedSizeGroup="column4"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0" 
                                                           Width="100"
                                                           Margin="0 5 5 5" 
                                                           Text="{Binding Path=Name}"
                                                           FontWeight="Bold" Foreground="#c2422b"/>

                                                <Expander Grid.Column="1" 
                                                          Width="310"
                                                          Margin="5 5 15 5" 
                                                          Header="Projects"
                                                          Expanded="customerProjectsExpander_Expanded" 
                                                          Collapsed="customerProjectsExpander_Collapsed">

                                                    <ItemsControl ItemsSource="{Binding Projects}">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <StackPanel Background="{StaticResource ItemsBackground}">
                                                                    <TextBlock Text="{Binding Name}" Margin="20 5 20 5"/>
                                                                    <Rectangle Stroke="#C2C2C2" Height="1" Grid.ColumnSpan="6"/>
                                                                </StackPanel>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </Expander>

                                                <Image Height="20" Grid.Column="2" Margin="5" VerticalAlignment="Top" Source="../../Resources/Icons/editing.png" Width="20"
                                                       Visibility="{Binding ElementName=mainWindow, Path=DataContext.CurrentUser.IsAdmin, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                                       MouseUp="EditCustomer_ImageClick" Cursor="Hand"/>

                                                <Image Height="20" Grid.Column="3" Margin="0 5 5 5" VerticalAlignment="Top" Source="../../Resources/Icons/bin.png" Width="20"
                                                        MouseUp="RemoveCustomer_ImageClick" Cursor="Hand"/>
                                            </Grid>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                    </Grid>
                </Grid>
            </TabItem>

            <TabItem HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" Header="Projects"
                     Visibility="{Binding CurrentUser.IsAdmin, Converter={StaticResource BoolToVisibilityConverter}}" Tag="../Icons/projects.png">
                <Grid Background="White">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0" HorizontalAlignment="Stretch" Margin="20 20 20 0">

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition SharedSizeGroup="stackPanel" Width="335"/>
                            <ColumnDefinition SharedSizeGroup="button"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Orientation="Horizontal">
                            <TextBox x:Name="NewProjectTextBox" VerticalContentAlignment="Center" Margin="0 5" Width="150" Height="20" VerticalAlignment="Center" Style="{StaticResource AddingTextBoxStyle}"/>

                            <ComboBox x:Name="createProjectComboBox" Width="150" 
                                    Style="{StaticResource ComboBoxFlatStyle}"
                                    ItemsSource="{Binding ElementName=mainWindow, Path=CustomersComboBox}"
                                    Text="[Select customer]"
                                    Height="25"
                                    Margin="5 5 0 5"/>

                            <Button Click="CreateNewProjectButton_Click" Template="{StaticResource HyperlinkButtonTemplate}" Margin="5" Width="Auto" 
                                HorizontalAlignment="Right" VerticalAlignment="Center" Height="20">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ElementName=createProjectComboBox, Path=SelectedItem}" Value="{x:Null}">
                                                <Setter Property="IsEnabled" Value="False"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                                <Image Source="../../Resources/Icons/plus.png" Height="18" ToolTip="Create project" />
                            </Button>
                        </StackPanel>

                        <Button Grid.Column="1" Command="{Binding ElementName=mainWindow, Path=GetProjectsCommand}" Template="{StaticResource HyperlinkButtonTemplate}" HorizontalAlignment="Right">
                            <Image Source="../../Resources/Icons/refresh_black.png" Height="18" ToolTip="Refresh" />
                        </Button>
                    </Grid>


                    <Grid Grid.Row="1"
                          Margin="20" 
                          Height="50"
                          Width="50"
                          Visibility="{Binding ElementName=mainWindow, Path=ItemsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                          HorizontalAlignment="Center" 
                          VerticalAlignment="Center">

                        <controls:SpinnersCogs/>
                    </Grid>

                    <Grid VerticalAlignment="Top" 
                          Grid.Row="1"
                          Margin="20"
                          Visibility="{Binding ElementName=mainWindow, Path=ItemsLoading, Converter={StaticResource BoolToNotVisibilityConverter}}">

                        <ScrollViewer
                              MinHeight="100"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalAlignment="Stretch">

                            <ItemsControl x:Name="ProjectsItemsControl" ItemsSource="{Binding ElementName=mainWindow, Path=Projects, Mode=TwoWay}" Grid.IsSharedSizeScope="True">

                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid HorizontalAlignment="Stretch">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition/>
                                            </Grid.RowDefinitions>

                                            <Rectangle Stroke="#C2C2C2" Height="1" Grid.ColumnSpan="3" />

                                            <Grid HorizontalAlignment="Center" Grid.Row="1" Margin="0 10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition SharedSizeGroup="column1"/>
                                                    <ColumnDefinition SharedSizeGroup="column2"/>
                                                    <ColumnDefinition SharedSizeGroup="column3"/>
                                                    <ColumnDefinition SharedSizeGroup="column4"/>
                                                    <ColumnDefinition SharedSizeGroup="column5"/>
                                                </Grid.ColumnDefinitions>


                                                <TextBlock Grid.Column="0" 
                                                           Width="100"
                                                           Margin="0 5 5 5" 
                                                           Text="{Binding Path=Customer.Name}"
                                                           Foreground="#4d4d4d"
                                                           TextAlignment="Left"/>

                                                <TextBlock Grid.Column="1" 
                                                           Width="130"
                                                           Margin="5" 
                                                           Text="{Binding Path=Name}"
                                                           TextAlignment="Left"
                                                           FontWeight="Bold"/>

                                                <Expander Grid.Column="2" 
                                                          Width="150"
                                                          Margin="10 5 15 5" 
                                                          Header="Tasks">

                                                    <ItemsControl ItemsSource="{Binding Activities}">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <StackPanel Background="{StaticResource ItemsBackground}">
                                                                    <TextBlock Text="{Binding Name}" Margin="20 5 20 5"/>
                                                                    <Rectangle Stroke="#C2C2C2" Height="1" Grid.ColumnSpan="6"/>
                                                                </StackPanel>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </Expander>

                                                <Image Height="20" Grid.Column="3" Margin="5" VerticalAlignment="Top" Source="../../Resources/Icons/editing.png" Width="20"
                                                       Visibility="{Binding ElementName=mainWindow, Path=DataContext.CurrentUser.IsAdmin, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                                       MouseUp="EditProject_ImageClick" Cursor="Hand"/>

                                                <Image Height="20" Grid.Column="4" Margin="0 5 5 5" VerticalAlignment="Top" Source="../../Resources/Icons/bin.png" Width="20"
                                                       MouseUp="RemoveProject_ImageClick" Cursor="Hand"/>
                                            </Grid>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                    </Grid>
                </Grid>
            </TabItem>

            <TabItem HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" Header="Tasks"
                     Visibility="{Binding CurrentUser.IsAdmin, Converter={StaticResource BoolToVisibilityConverter}}" Tag="../Icons/tasks.png">
                <Grid Background="White">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0" HorizontalAlignment="Stretch" Margin="20 20 20 0">

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition SharedSizeGroup="stackPanel" Width="335"/>
                            <ColumnDefinition SharedSizeGroup="button"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Orientation="Horizontal">
                            <TextBox x:Name="NewTaskTextBox" VerticalContentAlignment="Center" Margin="0 5" Width="150" Height="20" VerticalAlignment="Center" Style="{StaticResource AddingTextBoxStyle}"/>

                            <ComboBox x:Name="createTaskComboBox"
                                      Width="150"
                                      Style="{StaticResource ComboBoxFlatStyle}"
                                      ItemsSource="{Binding ElementName=mainWindow, Path=ProjectsComboBox}"
                                      Text="[Select project]"
                                      Height="25"
                                      Margin="5"/>

                            
                            <Button Click="CreateNewTaskButton_Click" Template="{StaticResource HyperlinkButtonTemplate}" Margin="0 5 5 5" VerticalAlignment="Center">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ElementName=createTaskComboBox, Path=SelectedItem}" Value="{x:Null}">
                                                <Setter Property="IsEnabled" Value="False"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                                <Image Source="../../Resources/Icons/plus.png" Height="18" ToolTip="Create task" />
                            </Button>
                        </StackPanel>
                        
                        <Button Grid.Column="1" Command="{Binding ElementName=mainWindow, Path=GetActivitiesCommand}" Template="{StaticResource HyperlinkButtonTemplate}" HorizontalAlignment="Right">
                            <Image Source="../../Resources/Icons/refresh_black.png" Height="18" ToolTip="Refresh" />
                        </Button>
                    </Grid>

                    <Grid Grid.Row="1"
                          Margin="20" 
                          Height="50"
                          Width="50"
                          Visibility="{Binding ElementName=mainWindow, Path=ItemsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                          HorizontalAlignment="Center" 
                          VerticalAlignment="Center">

                        <controls:SpinnersCogs/>
                    </Grid>

                    <Grid VerticalAlignment="Top" 
                          Grid.Row="1"
                          Margin="20"
                          Background="{StaticResource ItemsBackground}"
                          Visibility="{Binding ElementName=mainWindow, Path=ItemsLoading, Converter={StaticResource BoolToNotVisibilityConverter}}">

                        <ScrollViewer
                              MinHeight="100"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalAlignment="Stretch">

                            <ItemsControl x:Name="TasksItemsControl" ItemsSource="{Binding ElementName=mainWindow, Path=Activities, Mode=TwoWay}" Grid.IsSharedSizeScope="True">

                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid HorizontalAlignment="Stretch">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition/>
                                            </Grid.RowDefinitions>

                                            <Rectangle Stroke="#C2C2C2" Height="1" Grid.ColumnSpan="3" />

                                            <Grid HorizontalAlignment="Center" Grid.Row="1" Margin="0 10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition SharedSizeGroup="column1"/>
                                                    <ColumnDefinition SharedSizeGroup="column2"/>
                                                    <ColumnDefinition SharedSizeGroup="column3"/>
                                                    <ColumnDefinition SharedSizeGroup="column4"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0" 
                                                           Width="130"
                                                           Margin="20 5 5 5" 
                                                           Text="{Binding Path=Project.Name}"
                                                           Foreground="#4d4d4d"/>

                                                <TextBlock Grid.Column="1" 
                                                           Width="240"
                                                           Margin="5 5 20 5" 
                                                           Text="{Binding Path=Name}"
                                                           FontWeight="Bold"/>

                                                <Image Height="20" Grid.Column="2" Margin="5" VerticalAlignment="Top" Source="../../Resources/Icons/editing.png" Width="20"
                                                        Visibility="{Binding ElementName=mainWindow, Path=DataContext.CurrentUser.IsAdmin, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                                       MouseUp="EditActivity_ImageClick" Cursor="Hand"/>

                                                <Image Height="20" Grid.Column="3" Margin="0 5 5 5" VerticalAlignment="Top" Source="../../Resources/Icons/bin.png" Width="20"
                                                       MouseUp="RemoveActivity_ImageClick" Cursor="Hand"/>
                                            </Grid>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                    </Grid>
                </Grid>
            </TabItem>

            <TabItem HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" Header="Settings" Tag="../Icons/settings.png">

                <Grid Background="White">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Margin="20 20">
                        <CheckBox x:Name="RunOnStartupCheckBox"
                                      Margin="10" FontSize="13"
                                      Content="Run on startup" 
                                      Checked="RunOnStartup_Checked"
                                      Unchecked="RunOnStartup_Unchecked"/>

                        <CheckBox x:Name="EnableNotificationCheckBox"
                                      Margin="10" FontSize="13"
                                      Content="Enable notifications" 
                                      Checked="EnableNotification_Checked"
                                      Unchecked="EnableNotification_Unchecked"/>

                        <CheckBox x:Name="EnableGreetingNotificationCheckBox"
                                      Margin="10" FontSize="13"
                                      Content="Enable greeting" 
                                      Checked="EnableGreetingNotificationCheckBox_Checked"
                                      Unchecked="EnableGreetingNotificationCheckBox_Unchecked"/>

                    </StackPanel>

                </Grid>
            </TabItem>
        </TabControl>

        <Grid Grid.Row="1">
            <StackPanel HorizontalAlignment="Right" Margin="10 5 0 10" Orientation="Horizontal">
                <Image Source="../../Resources/Icons/refresh.png" MouseUp="RefreshAll_Click" Height="18" Margin="0 5 5 5" Cursor="Hand" ToolTip="Refresh"/>
                <Image Source="../../Resources/Icons/exit.png" MouseUp="SignOutButton_Click" Height="18" Margin="5 5 0 5" Cursor="Hand" ToolTip="Sign Out"/>
            </StackPanel>
        </Grid>

    </Grid>
</Window>

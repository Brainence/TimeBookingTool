<Window x:Class="TBT.App.Views.Windows.MainWindow"
        x:Name="mainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:TBT.App.Views.Windows"
        xmlns:vm="clr-namespace:TBT.App.ViewModels"
        xmlns:controls="clr-namespace:TBT.App.Views.Controls"
        Closing="Window_Closing"
        mc:Ignorable="d"
        Loaded="this_Loaded"
        Icon="../../calendar_clock.ico"
        SizeChanged="this_SizeChanged"
        Title="Time Booking Tool" 
        Height="700" 
        Width="600" 
        ResizeMode="CanMinimize"
        Style="{StaticResource WindowStyle}">

    <Window.DataContext>
        <vm:MainWindowViewModel/>
    </Window.DataContext>
    <Grid Margin="20 20 20 0">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>

        </Grid.ColumnDefinitions>


        <TabControl Grid.Row="0">
            <TabItem HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" Header="Calendar" Tag="../Icons/calendar.png">
                <controls:CalendarControl x:Name="calendar" User="{Binding CurrentUser, Mode=TwoWay}" IsDateNameShort="False" Background="White"/>
            </TabItem>

            <TabItem HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" Header="Reporting" Tag="../Icons/reporting.png">
                <Grid Background="White">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch" Grid.Row="0"
                                Visibility="{Binding CurrentUser.IsAdmin, Converter={StaticResource BoolToVisibilityConverter}}" Margin="30 20 30 0">
                        <TextBlock Text="User" Width="50"
                                   Foreground="#4d4d4d" FontSize="13"
                                   VerticalAlignment="Center"
                                   TextAlignment="Left"/>
                        <ComboBox 
                                  Width="428" FontSize="13" FontWeight="Bold" Foreground="#c2422b"
                                  VerticalAlignment="Center"
                                  Style="{StaticResource ComboBoxFlatStyle}"
                                  ItemsSource="{Binding ElementName=mainWindow, Path=Users}" 
                                  SelectedValue="{Binding ElementName=mainWindow, Path=ReportingUser, Mode=TwoWay}"/>
                    </StackPanel>


                    <controls:ReportingControl Grid.Row="2" Margin="30 20 30 20"
                                               TimeEntries="{Binding ElementName=mainWindow, Path=TimeEntries, Mode=TwoWay}" 
                                               ItemsLoading="{Binding ElementName=mainWindow, Path=ItemsLoading, Mode=TwoWay}"
                                               From="{Binding ElementName=mainWindow, Path=From, Mode=TwoWay}"
                                               To="{Binding ElementName=mainWindow, Path=To, Mode=TwoWay}"
                                               IsAdmin="{Binding DataContext.CurrentUser.IsAdmin, RelativeSource={RelativeSource FindAncestor, AncestorType=Window}}"
                                               User="{Binding ElementName=mainWindow, Path=ReportingUser}"/>
                </Grid>
            </TabItem>

            <TabItem HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" Header="People" Tag="../Icons/people.png">
                <Grid Background="White">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Grid x:Name="newUserGrid" Grid.Row="0" Margin="10 10 10 0" Width="400"
                          Visibility="{Binding Path=CurrentUser.IsAdmin, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">

                        <controls:NewUserControl User="{Binding ElementName=mainWindow, Path=NewUser, Mode=TwoWay}" HorizontalAlignment="Stretch" />
                    </Grid>

                    <Grid Grid.Row="1" Margin="10 10 10 0"
                          Visibility="{Binding ElementName=mainWindow, Path=IsProfileEditing, Converter={StaticResource BoolToVisibilityConverter}}">

                        <Grid HorizontalAlignment="Center" Width="400">

                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Edit profile" FontSize="16" FontWeight="Bold" FontFamily="Sans-Serif Fonts" Margin="5"/>

                            <controls:EditUserControl User="{Binding Path=CurrentUser, Mode=TwoWay}" 
                                                      Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" 
                                                      ShowAdmin="False" 
                                                      ShowPassword="False"
                                                      ForSaving="True" />

                            <TextBlock Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Text="Change password" Margin="5" FontWeight="Bold" FontFamily="Sans-Serif Fonts"/>

                            <TextBlock Grid.Row="3" Grid.Column="0" VerticalAlignment="Center" Text="Old password" HorizontalAlignment="Right" Margin="2" />
                            <TextBlock Grid.Row="4" Grid.Column="0" VerticalAlignment="Center" Text="New password" HorizontalAlignment="Right" Margin="2"/>
                            <TextBlock Grid.Row="5" Grid.Column="0" VerticalAlignment="Center" Text="Confirm password" HorizontalAlignment="Right" Margin="2"/>


                            <PasswordBox x:Name="oldPassword" Grid.Row="3" Grid.Column="1" Margin="2" Height="20"/>
                            <PasswordBox x:Name="newPassword" Grid.Row="4" Grid.Column="1" Margin="2" Height="20"/>
                            <PasswordBox x:Name="confirmPassword" Grid.Row="5" Grid.Column="1" Margin="2" Height="20"/>

                            <Button Grid.Row="6" Grid.Column="1" Click="ChangePassword_ButtonClick" Content="Change" Template="{StaticResource HyperlinkButtonTemplate}"
                                    HorizontalAlignment="Right" Height="25" Margin="0 5 10 5"/>

                        </Grid>
                    </Grid>

                    <Grid Grid.Row="2">
                        <StackPanel Margin="0 10 20 10" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom">

                            <Button Content="Refresh" Margin="5"
                                    Click="RefreshUsers_ButtonClick" Template="{StaticResource HyperlinkButtonTemplate}"/>

                            <Button x:Name="editProfileButton" Margin="5" Content="Edit profile"
                                    Click="EditProfile_ButtonClick" Template="{StaticResource HyperlinkButtonTemplate}"/>

                        </StackPanel>
                    </Grid>

                    <Grid Grid.Row="3"
                          Margin="20" 
                          Height="50"
                          Width="50"
                          Visibility="{Binding ElementName=mainWindow, Path=UsersLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                          HorizontalAlignment="Center" 
                          VerticalAlignment="Center">

                        <controls:SpinnersCogs/>
                    </Grid>

                    <Grid Grid.Row="3"
                          Visibility="{Binding ElementName=mainWindow, Path=UsersLoading, Converter={StaticResource BoolToNotVisibilityConverter}}">
                        <ScrollViewer 
                              Margin="20" 
                              MinHeight="100"
                              VerticalScrollBarVisibility="Auto"
                              VerticalAlignment="Top" 
                              HorizontalAlignment="Stretch">

                            <ItemsControl ItemsSource="{Binding ElementName=mainWindow, Path=Users, Mode=TwoWay}" Grid.IsSharedSizeScope="True">

                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid HorizontalAlignment="Stretch"
                                                      Visibility="{Binding ElementName=mainWindow, Path=IsEditing, Converter={StaticResource BoolToNotVisibilityConverter}}">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition/>
                                            </Grid.RowDefinitions>

                                            <Rectangle Stroke="#C2C2C2" Height="1" Grid.ColumnSpan="6"/>

                                            <Grid HorizontalAlignment="Center" Grid.Row="1" Margin="5">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition SharedSizeGroup="FullName"/>
                                                    <ColumnDefinition SharedSizeGroup="Username"/>
                                                    <ColumnDefinition SharedSizeGroup="IsAdmin"/>
                                                    <ColumnDefinition SharedSizeGroup="Project"/>
                                                    <ColumnDefinition SharedSizeGroup="Remove"/>
                                                    <ColumnDefinition SharedSizeGroup="Edit"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Height="20" Grid.Column="0" Margin="10 5 10 5" Text="{Binding FullName}">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsAdmin}" Value="True">
                                                                    <Setter Property="Foreground" Value="Green"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>

                                                <TextBlock Height="20" Grid.Column="1" Margin="20 5 10 5" Text="{Binding Username}">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsAdmin}" Value="True">
                                                                    <Setter  Property="Foreground" Value="Green"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>

                                                <CheckBox Content="Admin" Height="20" Grid.Column="2" Margin="20 5 10 5" 
                                                              IsChecked="{Binding IsAdmin, Mode=TwoWay}"
                                                              Checked="CheckBox_Checked"
                                                              Unchecked="CheckBox_Unchecked"
                                                              IsEnabled="False"/>

                                                <controls:MultiSelectionComboBox Grid.Column="3" Margin="0 3 0 3"
                                                                                 ItemsSourceMultiple="{Binding Projects}" 
                                                                                 Width="250" Style="{StaticResource ComboBoxFlatStyle}"
                                                                                 Visibility="{Binding ElementName=mainWindow, Path=DataContext.CurrentUser.IsAdmin, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                                                                 User="{Binding}"/>


                                                <Button Height="20" Grid.Column="4" Margin="10 5 10 5" Content="Remove" 
                                                            Visibility="{Binding ElementName=mainWindow, Path=DataContext.CurrentUser.IsAdmin, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                                            Click="RemoveUser_ButtonClick" Template="{StaticResource HyperlinkButtonTemplate}"/>


                                                <Button Height="20" Grid.Column="5" Margin="10 5 10 5" Content="Edit" 
                                                            Visibility="{Binding ElementName=mainWindow, Path=DataContext.CurrentUser.IsAdmin, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                                            Click="EditUser_ButtonClick" Template="{StaticResource HyperlinkButtonTemplate}"/>
                                            </Grid>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>
                </Grid>
            </TabItem>

            <TabItem HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" Header="Customers"
                     Visibility="{Binding CurrentUser.IsAdmin, Converter={StaticResource BoolToVisibilityConverter}}" Tag="../Icons/customers.png">
                <Grid Background="White">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>


                    <Button Grid.Row="0" HorizontalAlignment="Right" Height="20" Width="100" Margin="10"
                            Content="Refresh" Command="{Binding ElementName=mainWindow, Path=GetCustomersCommand}"
                            Template="{StaticResource HyperlinkButtonTemplate}"/>

                    <Grid Grid.Row="0" HorizontalAlignment="Center">

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition SharedSizeGroup="label"/>
                            <ColumnDefinition SharedSizeGroup="textBox" MinWidth="150"/>
                        </Grid.ColumnDefinitions>

                        <Button Click="CreateNewCustomerButton_Click" Content="Create customer" Template="{StaticResource HyperlinkButtonTemplate}" Margin="5" Grid.Column="0" Grid.Row="0"
                            HorizontalAlignment="Right">
                        </Button>
                        <TextBox x:Name="NewCustomerTextBox" VerticalContentAlignment="Center" Margin="5" Grid.Column="1" Grid.Row="0" Width="250"/>

                    </Grid>

                    <Grid Grid.Row="1"
                          Margin="20" 
                          Height="50"
                          Width="50"
                          Visibility="{Binding ElementName=mainWindow, Path=ItemsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                          HorizontalAlignment="Center" 
                          VerticalAlignment="Center">

                        <controls:SpinnersCogs/>
                    </Grid>

                    <Grid VerticalAlignment="Top" 
                          Grid.Row="1"
                          Margin="20"
                          Visibility="{Binding ElementName=mainWindow, Path=ItemsLoading, Converter={StaticResource BoolToNotVisibilityConverter}}">

                        <ScrollViewer
                              MinHeight="100"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalAlignment="Stretch">

                            <ItemsControl x:Name="CustomersItemsControl" ItemsSource="{Binding ElementName=mainWindow, Path=Customers, Mode=TwoWay}" Grid.IsSharedSizeScope="True">

                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid HorizontalAlignment="Stretch">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition/>
                                            </Grid.RowDefinitions>

                                            <Rectangle Stroke="#C2C2C2" Height="1" Grid.ColumnSpan="3" />

                                            <Grid HorizontalAlignment="Center" Grid.Row="1" Margin="10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition SharedSizeGroup="column1"/>
                                                    <ColumnDefinition SharedSizeGroup="column2"/>
                                                    <ColumnDefinition SharedSizeGroup="column3"/>
                                                    <ColumnDefinition SharedSizeGroup="column4"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0" 
                                                           MaxWidth="350"
                                                           Margin="20 5 20 5" 
                                                           Text="{Binding Path=Name}"
                                                           FontWeight="Bold"/>

                                                <Expander Grid.Column="1" 
                                                          MinWidth="300"
                                                          Margin="20 5 20 5" 
                                                          Header="Projects"
                                                          Expanded="customerProjectsExpander_Expanded" 
                                                          Collapsed="customerProjectsExpander_Collapsed">

                                                    <ItemsControl ItemsSource="{Binding Projects}">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <StackPanel Background="{StaticResource ItemsBackground}">
                                                                    <TextBlock Text="{Binding Name}" Margin="20 5 20 5"/>
                                                                    <Rectangle Stroke="#C2C2C2" Height="1" Grid.ColumnSpan="6"/>
                                                                </StackPanel>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </Expander>

                                                <Button Height="20" Grid.Column="2" Margin="10 5 10 5" Content="Remove" VerticalAlignment="Top"
                                                        Click="RemoveCustomer_ButtonClick" Template="{StaticResource HyperlinkButtonTemplate}"/>

                                                <Button Height="20" Grid.Column="3" Margin="10 5 10 5" Content="Edit" VerticalAlignment="Top"
                                                            Visibility="{Binding ElementName=mainWindow, Path=DataContext.CurrentUser.IsAdmin, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                                            Click="EditCustomer_ButtonClick" Template="{StaticResource HyperlinkButtonTemplate}"/>
                                            </Grid>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                    </Grid>
                </Grid>
            </TabItem>

            <TabItem HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" Header="Projects"
                     Visibility="{Binding CurrentUser.IsAdmin, Converter={StaticResource BoolToVisibilityConverter}}" Tag="../Icons/projects.png">
                <Grid Background="White">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Button Grid.Row="0" HorizontalAlignment="Right" Height="20" Width="100" Margin="10"
                            Content="Refresh" Command="{Binding ElementName=mainWindow, Path=GetProjectsCommand}"
                            Template="{StaticResource HyperlinkButtonTemplate}"/>

                    <Grid Grid.Row="0" HorizontalAlignment="Center">

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition SharedSizeGroup="label"/>
                            <ColumnDefinition SharedSizeGroup="textBox" MinWidth="150"/>
                            <ColumnDefinition SharedSizeGroup="comboBox" MinWidth="150"/>
                        </Grid.ColumnDefinitions>

                        <Button Click="CreateNewProjectButton_Click" Content="Create project" Template="{StaticResource HyperlinkButtonTemplate}" Margin="5" Grid.Column="0" Grid.Row="0"
                            HorizontalAlignment="Right" VerticalAlignment="Bottom" Height="20">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ElementName=createProjectComboBox, Path=SelectedItem}" Value="{x:Null}">
                                            <Setter Property="IsEnabled" Value="False"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        <TextBox x:Name="NewProjectTextBox" VerticalContentAlignment="Center" Margin="5" Grid.Column="1" Grid.Row="0" Height="20" VerticalAlignment="Bottom"/>

                        <StackPanel Grid.Column="2" Grid.Row="0">
                            <TextBlock Text="Customer:" Margin="5 0 0 0" Height="25"/>
                            <ComboBox x:Name="createProjectComboBox"
                                      Style="{StaticResource ComboBoxFlatStyle}"
                                      ItemsSource="{Binding ElementName=mainWindow, Path=CustomersComboBox}"
                                      Text="[Select customer]"
                                      Width="300"
                                      Height="25"
                                      Margin="5"/>
                        </StackPanel>

                    </Grid>

                    <Grid Grid.Row="1"
                          Margin="20" 
                          Height="50"
                          Width="50"
                          Visibility="{Binding ElementName=mainWindow, Path=ItemsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                          HorizontalAlignment="Center" 
                          VerticalAlignment="Center">

                        <controls:SpinnersCogs/>
                    </Grid>

                    <Grid VerticalAlignment="Top" 
                          Grid.Row="1"
                          Margin="20"
                          Visibility="{Binding ElementName=mainWindow, Path=ItemsLoading, Converter={StaticResource BoolToNotVisibilityConverter}}">

                        <ScrollViewer
                              MinHeight="100"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalAlignment="Stretch">

                            <ItemsControl x:Name="ProjectsItemsControl" ItemsSource="{Binding ElementName=mainWindow, Path=Projects, Mode=TwoWay}" Grid.IsSharedSizeScope="True">

                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid HorizontalAlignment="Stretch">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition/>
                                            </Grid.RowDefinitions>

                                            <Rectangle Stroke="#C2C2C2" Height="1" Grid.ColumnSpan="3" />

                                            <Grid HorizontalAlignment="Center" Grid.Row="1" Margin="10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition SharedSizeGroup="column1"/>
                                                    <ColumnDefinition SharedSizeGroup="column2"/>
                                                    <ColumnDefinition SharedSizeGroup="column3"/>
                                                    <ColumnDefinition SharedSizeGroup="column4"/>
                                                    <ColumnDefinition SharedSizeGroup="column5"/>
                                                </Grid.ColumnDefinitions>


                                                <TextBlock Grid.Column="0" 
                                                           MaxWidth="350"
                                                           Margin="20 5 5 5" 
                                                           Text="{Binding Path=Customer.Name}"
                                                           Foreground="#4d4d4d"
                                                           TextAlignment="Right"/>

                                                <TextBlock Grid.Column="1" 
                                                           MaxWidth="350"
                                                           Margin="5 5 20 5" 
                                                           Text="{Binding Path=Name}"
                                                           TextAlignment="Left"
                                                           FontWeight="Bold"/>


                                                <Expander Grid.Column="2" 
                                                          MinWidth="300"
                                                          Margin="20 5 20 5" 
                                                          Header="Tasks">

                                                    <ItemsControl ItemsSource="{Binding Activities}">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <StackPanel Background="{StaticResource ItemsBackground}">
                                                                    <TextBlock Text="{Binding Name}" Margin="20 5 20 5"/>
                                                                    <Rectangle Stroke="#C2C2C2" Height="1" Grid.ColumnSpan="6"/>
                                                                </StackPanel>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </Expander>

                                                <Button Height="20" Grid.Column="3" Margin="10 5 10 5" Content="Remove" VerticalAlignment="Top"
                                                        Click="RemoveProject_ButtonClick" Template="{StaticResource HyperlinkButtonTemplate}"/>

                                                <Button Height="20" Grid.Column="4" Margin="10 5 10 5" Content="Edit" VerticalAlignment="Top"
                                                            Visibility="{Binding ElementName=mainWindow, Path=DataContext.CurrentUser.IsAdmin, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                                            Click="EditProject_ButtonClick" Template="{StaticResource HyperlinkButtonTemplate}"/>
                                            </Grid>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                    </Grid>
                </Grid>
            </TabItem>

            <TabItem HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" Header="Tasks"
                     Visibility="{Binding CurrentUser.IsAdmin, Converter={StaticResource BoolToVisibilityConverter}}" Tag="../Icons/tasks.png">
                <Grid Background="White">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Button Grid.Row="0" HorizontalAlignment="Right" Height="20" Width="100" Margin="10"
                            Content="Refresh" Command="{Binding ElementName=mainWindow, Path=GetActivitiesCommand}"
                            Template="{StaticResource HyperlinkButtonTemplate}"/>

                    <Grid Grid.Row="0" HorizontalAlignment="Center">

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition SharedSizeGroup="label"/>
                            <ColumnDefinition SharedSizeGroup="textBox" MinWidth="150"/>
                            <ColumnDefinition SharedSizeGroup="comboBox" MinWidth="150"/>
                        </Grid.ColumnDefinitions>

                        <Button Click="CreateNewTaskButton_Click" Content="Create task" Template="{StaticResource HyperlinkButtonTemplate}" Margin="5" Grid.Column="0" Grid.Row="2"
                            HorizontalAlignment="Right" VerticalAlignment="Bottom" Height="20">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ElementName=createTaskComboBox, Path=SelectedItem}" Value="{x:Null}">
                                            <Setter Property="IsEnabled" Value="False"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        <TextBox x:Name="NewTaskTextBox" VerticalContentAlignment="Center" Margin="5" Grid.Column="1" Grid.Row="2" Height="20" VerticalAlignment="Bottom"/>

                        <StackPanel Grid.Column="2" Grid.Row="2">
                            <TextBlock Text="Project:" Margin="5 0 0 0" Height="25"/>
                            <ComboBox x:Name="createTaskComboBox"
                                      Grid.Column="2" Grid.Row="2"
                                      Style="{StaticResource ComboBoxFlatStyle}"
                                      ItemsSource="{Binding ElementName=mainWindow, Path=ProjectsComboBox}"
                                      Text="[Select project]"
                                      Width="300"
                                      Height="25"
                                      Margin="5"/>
                        </StackPanel>

                    </Grid>

                    <Grid Grid.Row="1"
                          Margin="20" 
                          Height="50"
                          Width="50"
                          Visibility="{Binding ElementName=mainWindow, Path=ItemsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                          HorizontalAlignment="Center" 
                          VerticalAlignment="Center">

                        <controls:SpinnersCogs/>
                    </Grid>

                    <Grid VerticalAlignment="Top" 
                          Grid.Row="1"
                          Margin="20"
                          Background="{StaticResource ItemsBackground}"
                          Visibility="{Binding ElementName=mainWindow, Path=ItemsLoading, Converter={StaticResource BoolToNotVisibilityConverter}}">

                        <ScrollViewer
                              MinHeight="100"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalAlignment="Stretch">

                            <ItemsControl x:Name="TasksItemsControl" ItemsSource="{Binding ElementName=mainWindow, Path=Activities, Mode=TwoWay}" Grid.IsSharedSizeScope="True">

                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid HorizontalAlignment="Stretch">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition/>
                                            </Grid.RowDefinitions>

                                            <Rectangle Stroke="#C2C2C2" Height="1" Grid.ColumnSpan="3" />

                                            <Grid HorizontalAlignment="Center" Grid.Row="1" Margin="10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition SharedSizeGroup="column1"/>
                                                    <ColumnDefinition SharedSizeGroup="column2"/>
                                                    <ColumnDefinition SharedSizeGroup="column3"/>
                                                    <ColumnDefinition SharedSizeGroup="column4"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0" 
                                                           MaxWidth="350"
                                                           Margin="20 5 5 5" 
                                                           Text="{Binding Path=Project.Name}"
                                                           Foreground="#4d4d4d"
                                                           TextAlignment="Right"/>

                                                <TextBlock Grid.Column="1" 
                                                           MaxWidth="350"
                                                           Margin="5 5 20 5" 
                                                           Text="{Binding Path=Name}"
                                                           FontWeight="Bold"/>

                                                <Button Height="20" Grid.Column="2" Margin="10 5 10 5" Content="Remove" 
                                                        Click="RemoveActivity_ButtonClick" Template="{StaticResource HyperlinkButtonTemplate}"/>

                                                <Button Height="20" Grid.Column="3" Margin="10 5 10 5" Content="Edit" VerticalAlignment="Top"
                                                            Visibility="{Binding ElementName=mainWindow, Path=DataContext.CurrentUser.IsAdmin, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                                            Click="EditActivity_ButtonClick" Template="{StaticResource HyperlinkButtonTemplate}"/>
                                            </Grid>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                    </Grid>
                </Grid>
            </TabItem>

            <TabItem HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" Header="Settings" Tag="../Icons/settings.png">

                <Grid Background="White">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <GroupBox Header="Settings">
                        <StackPanel Margin="10 20 10 10">
                            <CheckBox x:Name="RunOnStartupCheckBox"
                                      Margin="10"
                                      Content="Run on startup" 
                                      Checked="RunOnStartup_Checked"
                                      Unchecked="RunOnStartup_Unchecked"/>

                            <CheckBox x:Name="EnableNotificationCheckBox"
                                      Margin="10"
                                      Content="Enable notifications" 
                                      Checked="EnableNotification_Checked"
                                      Unchecked="EnableNotification_Unchecked"/>

                            <CheckBox x:Name="EnableGreetingNotificationCheckBox"
                                      Margin="10"
                                      Content="Enable greeting" 
                                      Checked="EnableGreetingNotificationCheckBox_Checked"
                                      Unchecked="EnableGreetingNotificationCheckBox_Unchecked"/>
                            
                        </StackPanel>
                    </GroupBox>

                </Grid>
            </TabItem>
        </TabControl>

        <Grid Grid.Row="1">
            <StackPanel HorizontalAlignment="Right" Margin="10 0 20 10" Orientation="Horizontal">
                <Button Click="RefreshAll_Click" Height="20" Margin="0 5 10 5" Content="Refresh" Template="{StaticResource BottomHyperlinkButtonTemplate}" HorizontalContentAlignment="Center"/>
                <Button Click="SignOutButton_Click" Height="20" Margin="10 5 0 5" Content="Sign out" Template="{StaticResource BottomHyperlinkButtonTemplate}" HorizontalContentAlignment="Center"/>
            </StackPanel>
        </Grid>

    </Grid>
</Window>
